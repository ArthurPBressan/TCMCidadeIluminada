{% extends "base.html" %}
{% block title %}Protocolos{% endblock %}

{% block body_tail %}
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js"></script>
<script src='//code.angularjs.org/1.3.0/angular.js'></script>
<script src='//code.angularjs.org/1.3.0/angular-resource.js'></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pusher/2.2.4/pusher.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pusher-angular/0.1.4/pusher-angular.min.js"></script>
{% assets output='gen/protocolos/lista_protocolos.js',
 'protocolos/js/app.js' %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
{% endblock %}

{% block content %}
<div ng-app="protocolosApp" ng-controller="ProtocolosListaController" class="container-fluid row-fluid">
    <div class="span2">
        {{ current_user.username }}
    </div>
    <div class="span10">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>
                        Código
                    </th>
                    <th>
                        Criação
                    </th>
                    <th>
                        Foto
                    </th>
                    <th>
                        Status
                    </th>
                    <th>&nbsp;</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="protocolo in protocolos">
                    <td>
                        [[ protocolo.cod_protocolo ]]
                    </td>
                    <td>
                        [[ protocolo.timestamp ]]
                    </td>
                    <td>
                        <a target="_blank" href="/protocolos/[[ protocolo.id ]]/foto/">Foto</a>
                    </td>
                    <td>
                        [[ protocolo.status ]]
                    </td>
                    <td>
                        <form name="statusForm" ng-submit="sendStatus(protocolo, pedido._status)">
                            <select name="status" ng-model="pedido._status" ng-options="status for status in statusProtocolos">
                            </select>
                            <button type="submit">Mudar</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
